init_death_spells_effect = {
    # add_to_global_variable_list = { name = death_spells target = flag:raise_dead } # Casted through other means
    add_to_global_variable_list = { name = death_spells target = flag:death_coil }
}

init_raise_undead_types_effect = {
    add_to_global_variable_list = { name = raise_dead_types target = flag:undead }
    add_to_global_variable_list = { name = raise_dead_types target = flag:ghoul }
    add_to_global_variable_list = { name = raise_dead_types target = flag:abomination }
    add_to_global_variable_list = { name = raise_dead_types target = flag:banshee }
    add_to_global_variable_list = { name = raise_dead_types target = flag:vampire }
}

cast_raise_dead_effect = {
    if = {
        limit = { exists = var:raise_dead_recipient }
        var:raise_dead_recipient = {
            save_temporary_scope_as = first_recipient
        }

        save_scope_value_as = {
            name = raise_dead_type
            value = var:raise_dead_type
        }

        var:raise_dead_type = {
            save_scope_as = raise_dead_type
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:raise_dead
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_temporary_scope_as = first_recipient
        }

        var:current_raise_dead_type = {
            save_scope_as = raise_dead_type
        }
    }

    scope:first_recipient ?= {
        show_as_tooltip = {
            switch = {
                trigger = scope:raise_dead_type

                flag:undead = { add_trait = being_undead }
                flag:abomination = { set_trait_rank = { trait = race rank = 21 } }
                flag:banshee = { set_trait_rank = { trait = race rank = 84 } }
                flag:ghoul = { set_trait_rank = { trait = race rank = 85 } }
                flag:vampire = { set_trait_rank = { trait = race rank = 86 } }
            }
        }

        custom_tooltip = {
            text = raise_dead_tt
            wc_resurrect_CHARACTER_with_STATUS_effect = { CHARACTER = scope:first_recipient STATUS = undead }
            scope:resurrected_character ?= {
                root = { add_courtier = prev }
                switch = {
                    trigger = scope:raise_dead_type

                    flag:undead = { add_trait = being_undead }
                    flag:abomination = { set_trait_rank = { trait = race rank = 21 } }
                    flag:banshee = { set_trait_rank = { trait = race rank = 84 } }
                    flag:ghoul = { set_trait_rank = { trait = race rank = 85 } }
                    flag:vampire = { set_trait_rank = { trait = race rank = 86 } }
                }
            }
        }
    }
}

cast_death_coil_effect = {
    if = {
        limit = { exists = var:death_coil_recipient }
        var:death_coil_recipient = {
            save_temporary_scope_as = first_recipient
        }

        save_scope_value_as = {
            name = death_coil_type
            value = var:death_coil_type
        }

        var:death_coil_type = {
            save_scope_as = death_coil_type
        }
    }
    else_if = {
        limit = {
            exists = var:current_spell_name
            var:current_spell_name = flag:death_coil
            exists = var:spellbook_open
            exists = var:spell_recipient
        }
        var:spell_recipient = {
            save_temporary_scope_as = first_recipient
        }

        var:current_death_coil_type = {
            save_scope_as = death_coil_type
        }
    }

    scope:first_recipient ?= {
        root = {
            save_temporary_scope_value_as = {
                name = duration
                value = wc_spell_death_coil_duration_days_value
            }
        }
        if = {
            limit = {
                has_trait = being_undead
            }
            add_character_modifier = {
                modifier = wc_death_coil_positive_modifier
                days = wc_current_spell_duration
            }
        }
        else = {
            add_character_modifier = {
                modifier = wc_death_coil_negative_modifier
                days = wc_current_spell_duration
            }
        }
    }
}